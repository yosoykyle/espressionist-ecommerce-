<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html(~{::section})}">
<body>
    <section>
        <h1 class="text-3xl font-bold text-coffee mb-8">Our Products</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div th:each="product : ${products}" class="bg-white rounded-lg shadow-md overflow-hidden">
                <img th:if="${product.image}" th:src="@{/api/products/image/{id}(id=${product.id})}" class="w-full h-48 object-cover" />
                <div class="p-4">
                    <h2 class="text-xl font-semibold text-coffee-dark mb-2" th:text="${product.name}">Product Name</h2>
                    <p class="text-gray-600 mb-2" th:text="${product.category}">Category</p>
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold" th:text="${'$' + #numbers.formatDecimal(product.price, 1, 2)}">$0.00</span>
                        <span th:if="${product.quantity > 0}" class="text-green-600" th:text="${product.quantity + ' in stock'}">In Stock</span>
                        <span th:unless="${product.quantity > 0}" class="text-red-600">Out of Stock</span>
                    </div>
                    <button th:if="${product.quantity > 0}" 
                            onclick="addToCart(this)" 
                            th:data-id="${product.id}"
                            th:data-name="${product.name}"
                            th:data-price="${product.price}"
                            class="mt-4 w-full bg-coffee hover:bg-coffee-dark text-white font-bold py-2 px-4 rounded transition duration-200">
                        Add to Cart
                    </button>
                </div>
            </div>
        </div>

        <script>
            function addToCart(button) {
                const product = {
                    id: button.dataset.id,
                    name: button.dataset.name,
                    price: parseFloat(button.dataset.price),
                    quantity: 1
                };

                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const existingItem = cart.find(item => item.id === product.id);

                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push(product);
                }

                localStorage.setItem('cart', JSON.stringify(cart));
                alert('Product added to cart!');
            }
        </script>
    </section>
</body>
</html>
