<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/base :: head">
    <title>espressionist - Products</title>
</head>
<body class="min-h-screen flex flex-col bg-white">
    <div th:replace="layout/base :: nav"></div>
    
    <main class="flex-grow">
        <!-- Products Header -->
        <section class="bg-primary text-white py-12 -mt-8">
            <div class="container mx-auto text-center">
                <h1 class="brand-font text-4xl mb-4">Our Products</h1>
                <p class="tagline-font text-xl">Crafted with passion, served with love.</p>
            </div>
        </section>

        <!-- Product Grid -->
        <section class="py-12">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Product Card -->
                    <div th:each="product : ${products}" class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="aspect-w-1 aspect-h-1">
                            <img th:if="${product.image != null}" 
                                 th:src="@{'/api/products/image/' + ${product.id}}"
                                 class="w-full h-full object-cover"
                                 th:alt="${product.name}">
                            <div th:unless="${product.image != null}" 
                                 class="w-full h-full bg-gray-200 flex items-center justify-center">
                                <span class="text-gray-400">No image</span>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold" th:text="${product.name}">Product Name</h3>
                            <p class="text-gray-600" th:text="${product.category}">Category</p>
                            <div class="mt-2 flex justify-between items-center">
                                <span class="text-primary text-xl font-bold" 
                                      th:text="${'â‚±' + #numbers.formatDecimal(product.price, 0, 'COMMA', 2, 'POINT')}">
                                    Price
                                </span>
                                <span th:if="${product.quantity > 0}" 
                                      class="text-sm text-gray-600" 
                                      th:text="${product.quantity + ' in stock'}">
                                    Stock
                                </span>
                                <span th:unless="${product.quantity > 0}" 
                                      class="text-sm text-red-600">
                                    Out of Stock
                                </span>
                            </div>
                            <button th:if="${product.quantity > 0}"
                                    onclick="addToCart(this)"
                                    th:data-id="${product.id}"
                                    th:data-name="${product.name}"
                                    th:data-price="${product.price}"
                                    class="mt-4 w-full bg-primary text-white py-2 px-4 rounded-full hover:bg-primary/90 transition">
                                Add to Cart
                            </button>
                            <button th:unless="${product.quantity > 0}"
                                    disabled
                                    class="mt-4 w-full bg-gray-300 text-gray-500 py-2 px-4 rounded-full cursor-not-allowed">
                                Out of Stock
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Cart Toast Notification -->
        <div id="cartToast" class="fixed bottom-4 right-4 bg-primary text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-full opacity-0 transition-all duration-300">
            Item added to cart
        </div>
    </main>

    <div th:replace="layout/base :: footer"></div>

    <script>
        // Initialize cart count
        const updateCartCount = () => {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        };

        // Update cart count on page load and storage changes
        document.addEventListener('DOMContentLoaded', updateCartCount);
        window.addEventListener('storage', updateCartCount);

        function addToCart(button) {
            const id = button.dataset.id;
            const name = button.dataset.name;
            const price = parseFloat(button.dataset.price);
            
            // Get existing cart or initialize new one
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            // Check if item already in cart
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    quantity: 1
                });
            }
            
            // Save updated cart
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update cart count
            updateCartCount();
            
            // Show toast notification
            const toast = document.getElementById('cartToast');
            toast.textContent = `Added ${name} to cart`;
            toast.style.transform = 'translateY(0)';
            toast.style.opacity = '1';
            
            // Hide toast after 2 seconds
            setTimeout(() => {
                toast.style.transform = 'translateY(100%)';
                toast.style.opacity = '0';
            }, 2000);
        }
    </script>
</body>
</html>
