<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/base :: head">
    <title>espressionist - Order Confirmed</title>
</head>
<body class="min-h-screen flex flex-col bg-white">
    <div th:replace="layout/base :: nav"></div>
    
    <main class="flex-grow">
        <div class="max-w-2xl mx-auto px-4 py-16">
            <div class="bg-white shadow-lg rounded-lg p-6">
                <div class="text-center mb-8">
                    <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <h1 class="text-3xl font-semibold text-gray-800 mb-2">Order Confirmed!</h1>
                    <p class="text-lg text-red-500 font-bold">Please save this code to track your order</p>
                    <div class="bg-gray-100 p-4 rounded-lg mt-4">
                        <span id="orderCode" class="text-2xl font-mono font-bold"></span>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4">Order Details</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Shipping Information</h3>
                                <p id="shippingInfo" class="mt-1 whitespace-pre-line"></p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Order Date</h3>
                                <p id="orderDate" class="mt-1"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-200 pt-6">
                    <h2 class="text-xl font-semibold mb-4">Order Items</h2>
                    <div id="orderItems" class="space-y-4">
                        <!-- Order items will be inserted here -->
                    </div>

                    <div class="mt-6 border-t border-gray-200 pt-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Subtotal</span>
                            <span id="subtotal"></span>
                        </div>
                        <div class="flex justify-between mt-2">
                            <span class="text-gray-600">VAT (12%)</span>
                            <span id="vat"></span>
                        </div>
                        <div class="flex justify-between mt-2 text-lg font-semibold">
                            <span>Total</span>
                            <span id="total"></span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <a th:href="@{/order-status}" class="inline-block bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors">
                        Track My Order
                    </a>
                </div>
            </div>
        </div>
    </main>

    <div th:replace="layout/base :: footer"></div>

    <script>
        function formatPrice(price) {
            return 'â‚±' + price.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        function displayOrderDetails() {
            const orderDetails = JSON.parse(sessionStorage.getItem('orderSuccess'));
            if (!orderDetails) {
                window.location.href = '/';
                return;
            }

            document.getElementById('orderCode').textContent = orderDetails.orderCode;
            document.getElementById('shippingInfo').textContent = orderDetails.shippingInfo;
            document.getElementById('orderDate').textContent = new Date(orderDetails.orderDate).toLocaleDateString();

            const orderItems = document.getElementById('orderItems');
            orderItems.innerHTML = '';

            let subtotal = 0;
            orderDetails.items.forEach(item => {
                const itemSubtotal = item.price * item.quantity;
                subtotal += itemSubtotal;

                const itemElement = document.createElement('div');
                itemElement.className = 'flex items-center';
                itemElement.innerHTML = `
                    <img src="/api/products/image/${item.productId}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                    <div class="ml-4 flex-grow">
                        <h3 class="font-medium">${item.name}</h3>
                        <p class="text-sm text-gray-500">Quantity: ${item.quantity}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-medium">${formatPrice(itemSubtotal)}</p>
                    </div>
                `;
                orderItems.appendChild(itemElement);
            });

            const vat = subtotal * 0.12;
            const total = subtotal + vat;

            document.getElementById('subtotal').textContent = formatPrice(subtotal);
            document.getElementById('vat').textContent = formatPrice(vat);
            document.getElementById('total').textContent = formatPrice(total);
        }

        // Display order details on page load
        document.addEventListener('DOMContentLoaded', displayOrderDetails);
    </script>
</body>
</html>
